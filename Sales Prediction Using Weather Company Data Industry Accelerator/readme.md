# Sales Prediction using the Weather Company Data

Download the project `sales-prediction-using-weather-company-data-industry-accelerator.tar.gz` from the Releases `CPDv3.0.x` and import it into Cloud Pak for Data v3.0.x. You can also follow the instructions from the [Community Page](https://community.ibm.com/community/user/cloudpakfordata/viewdocument/sales-prediction-using-the-weather) to download and import the project.


## Introduction
This WCDLE (Weather Company Data Limited Edition) Industry Accelerator, Sales Prediction Using The Weather Company Data, from the IBM CP4D (Cloud Pak for Data) platform can help your organization improve business outcomes by predicting and quantifying the impact of weather on your business (e.g., for instance the revenue or/and quantity of particular products). Moreover, this WCDLE solution has applications across a broad range of industries and has particularly relevant use cases to industries with sensitivity to changes in daily or/and seasonal weather conditions such as retail, consumer packaged goods, services, hospitality, entertainment, travel, and transportation.

Data scientists in your organization alone or collaboratively with IBM can use the data, notebooks, predictive models, and dashboards within CP4D Industry Accelerators such as this example to expedite and enhance routine analytics tasks (e.g., data preparing, machine-learning modeling, results reporting). Consequently, your company and clients can further pathways to financial success by analytically identifying the influence of weather on key business metrics then applying those insights to weather-driven outlooks for more business value.

In this demonstration, the below "OVERVIEW" section provides a description an exemplar analysis for a "Sales Prediction" use case that leverages the IBM CP4D platform with sample TWC (The Weather Company) weather data, simulated client data, and data science notebooks.



- [Instructions](#instructions)
- [Sample data assets](#data-assets)
- [Notebooks](#notebooks)
- [R Shiny dashboard](#dashboard)
- [Sample business glossary](#glossary)


<a id="instructions"></a>
## Instructions
Follow these steps to implement the industry accelerator:
1. Navigate to the **Assets** tab and scroll to the **Notebooks** section.

2. Edit the **buildpredictivemodels** notebook by clicking the edit icon that looks like a tiny pencil next to the notebook name. Follow the instructions in the notebook to step through the execution.

3. Edit and run the **applypredictivemodels** notebook. 

4. Edit and run the **makedashboarddata** notebook. 

5. Launch the r-shiny dashboard from one of the following ways.
    - Open the URL generated by deploying r-shiny dashboard in **makedashboarddata** notebook. 
    - Navigate to **`Deployments -> Spaces -> wxsignals_client -> Deployments -> wxsignals_Shiny_App`** to find the URL of deployed r-shiny dashboard and open it in a new tab.
    - Run the dashboard from RStudio console by completing these steps: <br>
     i. Download the `sales-prediction-using-weather-company-data-dashboard.zip` file from the Data assets section of the **Assets** page. If you don't see the file, click **View All** to display the full list of assets.<br>
     ii. Click **Launch IDE > RStudio** on the menu bar. <br>
     iii. In the **Files** pane, select the **Upload** toolbar button and upload the `sales-prediction-using-weather-company-data-dashboard.zip` file into RStudio.<br>
     iv. Select the `app.R` file, and click the **Run App** toolbar button to launch the dashboard. If you see a warning message that certain packages are not installed, you can ignore it because the packages will be installed first time you run the app. <br>

6. Optional. To connect the data assets used in this accelerator to the business terms in Watson Knowledge Catalog, you can edit and run the **0-map-business-terms-to-data-headers** notebook. Enter the authentication details required in the first few cells. 

 <a id="data-assets"></a>
## Sample data assets

The following provided data is faux (synthetic) data that simply serves the purpose to demonstrate a solution for a common business problem. Nonetheless, this demonstration does not permit the use of the herein simulated data beyond this Industry Accelerator example.

`fauxweather1.csv`: faux TWC weather data for 3 distinct postal codes and for ~2 years (e.g., 2016 and 2017)
`fauxweather2.csv`: faux TWC weather data for 3 distinct postal codes and for ~1 year (e.g., 2018)
`fauxsales1.csv`: faux client data for the same postal codes and date range as the fauxweather1.csv data.
`fauxsales2.csv`: faux client data for the same postal codes and date range as the fauxweather2.csv data.<br>

`config.py`: The script contains necessary predefined variables and custom functions for the buildpredictivemodels, applypredictivemodels, and makedashboarddata notebooks. <br>
`config2.py`: The script contains necessary predefined variables and custom functions for the deployed-environment scoring_pipeline `scoring function` of only the applypredictivemodels notebook. <br>

<a id="notebooks"></a>
## Notebooks

Follow the instructions in the notebooks to step through the execution.

**buildpredictivemodels**: Loads data; Prepare and clean data for model training; Correlation analysis; Build ML models, Analysis and visualization of data; Select best performing ML model and save to Cloud Pak for Data; Create a Watson Machine Learning based deployment space; Store the model in the space and deploy the model.

**applypredictivemodels**: Gets the deployment space and deployments; Deploys the data assets; Creating and deploying a function for model predictions (aka scoring); Computes model predictions.

**makedashboarddata**: Computes dashboard data both to evaluate the predictive performance of built models and to explore any potential predictive relationships between the weather variables and the sales variable. Store and deploy R Shiny app; Generate URL to view the app.


<a id="dashboard"></a>
## R Shiny dashboard

An R-Studio dashboard facilitates further evaluation and exploration of the primary "build models" and "apply models" analytics results in a centralized visualization tool. Presently, the dashboard performs the visualizations using the pre-computed datasets via the makedashboarddata notebook. However, future modifications of this dashboard also can utilize identifiable defined tags in the buildpredictivemodels or/and applypredictivemodels notebook(s) to more reactively compute the visualized data.

The dashboard contains the following panelled figures.

Figure 1 (top left) : This geomap illustrates the main overall information of the analytics in a centralized spatiotemporal manner. <br>
Figure 2 (top right) : The heatmap (all locales) and barplots (one locale) illustrate the importance (contribution) of each weather measure (variable) in predicting the sales.<br>
Figure 3 (bottom left) : The scatterplot illustrates the sales (dependent variable) vs weather (independent variable) for a single weather measure.<br>
Figure 4 (bottom left) : The densityplot illustrates the estimated probability density function for each single weather measure.
Figure 5 (middle right) : This boxplot illustrates the predicted sales with models using weather data vs the predicted sales with models not using weather data.<br>
Figure 6 (bottom right) : This scatterplot illustrates the predicted (estimated) vs observed (true) sales with MAE (mean absolute error) and R2 (coefficient of determination) stats.<br>
Figure 7 (bottom right) : This lineplot illustrates the predicted (estimated) vs observed (true) sales as a time series with MAPE and R2 stats.<br>
The dashboard contains the following display controls that applicably update the abovementioned figures.

Control 1 (choose places) : This radiobuttons interface adjusts the figures to illustrate data for all places or a specific place.<br>
Control 2 (choose date start) : This calendar interface adjusts the figures to illustrate data for the inclusive beginning date of a date range.<br>
Control 3 (choose date stop) : This calendar interface adjusts the figures to illustrate data for the inclusive ending date of a date range.<br>
Control 4 (choose weather variable) : This pulldown interface adjusts only Figure 4 to illustrate data for a single specific weather measure.<br>

Home page of the r-shiny dashboard would look like below
![alt text](https://public.dhe.ibm.com/software/data/sw-library/cognos/mobile/C11/catalog/images/cp4d/dashboard_wcdle_salesprediction.png)


<a id="glossary"></a>
## Business glossary for use with Watson Knowledge Catalog
Optionally, you can import the glossary of business terms into Watson Knowledge Catalog to get started on data governance using the below files available in the project tar file. <br>
The `sales-prediction-using-weather-company-data-glossary-categories.csv` file defines the main and sub categories for the business terms. <br>
The `sales-prediction-using-weather-company-data-glossary-terms.csv` file defines the business terms, category of the business terms and their Related Terms/Part of Terms, if applicable. <br>

Once the glossary is imported and published into Watson Knowledge Catalog, Navigate to **Governance > Categories > Industry Accelerator > Sales Prediction using Weather Company Data** to explore the glossary contents. 


## Data Disclaimer
The weather and business input data provided in this Accelerator is simulated data, designed to illustrate how to solve a common business problem. You are not permitted to utilize the simulated data contained in the Accelerator outside of this Accelerator or the Sample Materials contained within it.

## Copyright
This project contains Sample Materials, provided under license.
Licensed Materials - Property of IBM.
© Copyright IBM Corp. 2020. All Rights Reserved.
US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.

## Terms and Conditions
The terms under which you are licensing IBM Cloud Pak for Data also apply to your use of the Industry Accelerators.   Before you use the Industry Accelerators, you must agree on these additional terms and conditions that are set forth here.   This information contains sample modules, exercises, and code samples (the code may be provided in source code form (“Source Code”)) (collectively “Sample Materials”).

## License
  Subject to the terms herein, you may copy, modify, and distribute these Sample Materials within your enterprise only, for your internal use only; provided such use is within the limits of the license rights of the IBM agreement under which you are licensing IBM Cloud Pak for Data.   The Industry Accelerators might include applicable third-party licenses. Review the third-party licenses before you use any of the Industry Accelerators. You can find the third-party licenses that apply to each Sample Material in the notices.txt file that is included with each Sample Material.

## Code Security
  Source Code may not be disclosed to any third parties for any reason without IBM’s prior written consent, and access must be limited to your employees who have a need to know.   You have implemented and will maintain the technical and personnel focused security policies, procedures, and controls that are necessary to protect the Source Code against loss, alteration, unlawful forms of processing, unauthorized disclosure, and unauthorized access.   You will promptly (and in no event any later than 48 hours) notify IBM after becoming aware of any breach or other security incident that you know, or should reasonably suspect, affects or will affect the Source Code or IBM, and will provide IBM with reasonably requested information about such security incident and the status of any remediation and restoration activities.   You will not permit any Source Code to reside on servers located in the Russian Federation, the People’s Republic of China, or any territories worldwide in which the Russian Federation or People’s Republic of China claim sovereignty (collectively, “China or Russia”). Company shall not permit anyone to access or use any such Source Code from or within China or Russia, and Company will not permit any development, testing, or other work to occur in China or Russia that would require such access or use. Upon reasonable written notice, IBM may extend these restrictions to other countries that the United States government identifies as potential cyber security concerns. IBM may request that you verify compliance with these Code Security obligations, and you agree to cooperate with IBM in that regard.

## General
  Notwithstanding anything to the contrary, IBM PROVIDES THE SAMPLE MATERIALS ON AN "AS IS" BASIS AND IBM DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, ANY IMPLIED WARRANTIES OR CONDITIONS OF MERCHANTABILITY, SATISFACTORY QUALITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, AND ANY WARRANTY OR CONDITION OF NON-INFRINGEMENT. IBM SHALL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY OR ECONOMIC CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR OPERATION OF THE SAMPLE MATERIALS. IBM SHALL NOT BE LIABLE FOR LOSS OF, OR DAMAGE TO, DATA, OR FOR LOST PROFITS, BUSINESS REVENUE, GOODWILL, OR ANTICIPATED SAVINGS. IBM HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS OR MODIFICATIONS TO THE SAMPLE MATERIALS.
